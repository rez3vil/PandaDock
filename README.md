# PandaDock

Python-based molecular docking software for bioinformatics and drug design with physics-based approach

![PandaDock Logo](https://github.com/pritampanda15/PandaDock/blob/main/logo/pandadock-logo.png)

## Overview

PandaDock is a Python-based molecular docking tool that combines traditional docking approaches with advanced physics-based scoring and CHARMm-inspired algorithms. It offers flexible, accurate, and hardware-accelerated molecular docking capabilities for drug discovery and computational chemistry.

## Key Features

- üî¨ PDB and MOL/SDF file parsing
- üéØ Active site definition and automatic pocket detection
- üìä Multiple scoring functions:
  - Basic: van der Waals and hydrogen bonds
  - Enhanced: electrostatics, desolvation, and hydrophobic interactions
  - Physics-based: MM-GBSA inspired scoring with full molecular mechanics
- üß¨ Advanced search algorithms:
  - Random search
  - Genetic algorithm with local optimization
  - Monte Carlo sampling with simulated annealing
  - PANDADOCK algorithm (CHARMm-inspired)
  - Parallel implementations for CPU and GPU
- üîÑ Molecule preparation with hydrogen addition and energy minimization
- üîÄ Flexible residues docking
- üìè Validation against reference structures with RMSD calculations
- üìà Comprehensive results visualization and analysis
- ‚ö° Hardware acceleration with GPU and multi-core CPU

## Installation

### Prerequisites

PandaDock requires Python 3.6+ and the following dependencies:
- NumPy, SciPy, Matplotlib
- scikit-learn
- RDKit (optional but recommended)
- PyTorch or CuPy (optional for GPU acceleration)

### Install via pip

```bash
# Create virtual environment
python -m venv .venv
source .venv/bin/activate

# Install dependencies (recommended)
pip install rdkit
pip install torch  # For GPU acceleration

# Install PandaDock
pip install pandadock
```

### Install via conda

```bash
# First install RDKit with conda
conda install -c conda-forge rdkit

# Then install PandaDock
pip install pandadock
```

### GPU Acceleration (Optional)

```bash
# PyTorch with CUDA support
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# OR CuPy
pip install cupy-cuda11x
```

## Quick Start Examples

```bash
# Basic usage
pandadock -p protein.pdb -l ligand.sdf -o output_dir

# Physics-based docking with PANDADOCK algorithm
pandadock -p protein.pdb -l ligand.sdf -a pandadock --physics-based

# GPU-accelerated docking
pandadock -p protein.pdb -l ligand.sdf --use-gpu --physics-based

# Docking with automatic algorithm selection
pandadock -p protein.pdb -l ligand.sdf --auto-algorithm
```

## PANDADOCK Algorithm

PANDADOCK is a CHARMm-inspired docking algorithm that combines conformational sampling with molecular dynamics simulation. The protocol includes:

1. **Conformer Generation**: Multiple ligand conformers are generated by systematic rotation of rotatable bonds
2. **Random Orientation**: Each conformer is positioned in the binding site with multiple initial orientations
3. **Simulated Annealing**: Poses are refined using simulated annealing molecular dynamics
4. **Final Minimization**: A final energy minimization optimizes the poses
5. **Scoring and Ranking**: All poses are scored and ranked using the physics-based scoring function

## Command Line Arguments

### Basic Options
| Argument | Description |
|----------|-------------|
| `-h, --help` | Show help message and exit |
| `-p, --protein PROTEIN` | Path to protein PDB file |
| `-l, --ligand LIGAND` | Path to ligand MOL/SDF file |
| `-o, --output OUTPUT` | Output directory for docking results |
| `-a, --algorithm {random,genetic,pandadock}` | Docking algorithm to use (default: genetic) |
| `-i, --iterations ITERATIONS` | Number of iterations/generations (default: 100) |
| `-s, --site X Y Z` | Active site center coordinates |
| `-r, --radius RADIUS` | Active site radius in Angstroms (default: 10.0) |
| `--detect-pockets` | Automatically detect binding pockets |
| `--grid-spacing GRID_SPACING` | Grid spacing in √Ö for spherical grid sampling (default: 0.375 √Ö) |
| `--grid-radius GRID_RADIUS` | Grid radius in √Ö around the binding site for spherical sampling (default: 10.0 √Ö) |
| `--fast-mode` | Run with minimal enhancements for quick results |
| `--enhanced` | Use enhanced algorithms for more accurate (but slower) results |
| `--enhanced-scoring` | Use enhanced scoring function with electrostatics |
| `--prepare-molecules` | Prepare protein and ligand before docking (recommended) |
| `--population-size POPULATION_SIZE` | Population size for genetic algorithm (default: 100) |
| `--exhaustiveness EXHAUSTIVENESS` | Number of independent docking runs (default: 1) |
| `--local-opt` | Enable local optimization on top poses (default: disabled) |
| `--ph PH` | pH for protein preparation (default: 7.4) |
| `--physics-based` | Use full physics-based scoring (very slow but most accurate) |
| `--mmff-minimization` | Use MMFF94 force field minimization (requires RDKit) |
| `--monte-carlo` | Use Monte Carlo sampling instead of genetic algorithm |
| `--mc-steps MC_STEPS` | Number of Monte Carlo steps (default: 1000) |
| `--temperature TEMPERATURE` | Temperature for Monte Carlo simulation in Kelvin (default: 300K) |
| `--tethered-docking` | Use tethered scoring with reference structure |
| `--tether-weight TETHER_WEIGHT` | Weight for tethered scoring (higher = stronger tethering) |
| `--reference REFERENCE` | Reference ligand structure for validation |
| `--exact-alignment` | Align docked pose exactly to reference structure |
| `--auto-algorithm` | Automatically select the best docking algorithm based on your system |
| `--flex-residues FLEX_RESIDUES [FLEX_RESIDUES ...]` | Specify flexible residue IDs (e.g., A_42 B_57) |
| `--max-flex-bonds MAX_FLEX_BONDS` | Maximum rotatable bonds per residue (default: 3) |
| `--auto-flex` | Automatically detect flexible residues in the binding site |
| `--max-flex-residues MAX_FLEX_RESIDUES` | Maximum number of flexible residues to detect in auto mode (default: 5) |

### PandaDock Algorithm Options
| Argument | Description |
|----------|-------------|
| `--high-temp HIGH_TEMP` | High temperature for pandadock MD simulations (K) |
| `--target-temp TARGET_TEMP` | Target temperature for pandadock cooling (K) |
| `--num-conformers NUM_CONFORMERS` | Number of ligand conformers to generate in pandadock |
| `--num-orientations NUM_ORIENTATIONS` | Number of orientations to try for each conformer in pandadock |
| `--md-steps MD_STEPS` | Number of MD steps for simulated annealing in pandadock |
| `--minimize-steps MINIMIZE_STEPS` | Number of minimization steps for final refinement in pandadock |
| `--use-grid` | Use grid-based energy calculations in pandadock |
| `--cooling-factor COOLING_FACTOR` | Cooling factor for simulated annealing (applies to PANDADOCK and Monte Carlo) |

### Reporting Options
| Argument | Description |
|----------|-------------|
| `--report-format {text,csv,json,html,all}` | Report format (default: all) |
| `--report-name REPORT_NAME` | Custom name for the report files |
| `--detailed-energy` | Include detailed energy component breakdown in reports |
| `--skip-plots` | Skip generating plots for reports |

### Hardware Acceleration
| Argument | Description |
|----------|-------------|
| `--use-gpu` | Use GPU acceleration if available |
| `--gpu-id GPU_ID` | GPU device ID to use (default: 0) |
| `--gpu-precision {float32,float64}` | Numerical precision for GPU calculations (default: float32) |
| `--cpu-workers CPU_WORKERS` | Number of CPU workers for parallel processing (default: all cores) |
| `--cpu-affinity` | Set CPU affinity for better performance |
| `--workload-balance WORKLOAD_BALANCE` | GPU/CPU workload balance (0.0-1.0, higher values assign more work to GPU) |
| `--auto-tune` | Automatically tune hardware parameters for best performance |

### Advanced Search Algorithms
| Argument | Description |
|----------|-------------|
| `--advanced-search {gradient,replica-exchange,ml-guided,fragment-based,hybrid}` | Advanced search algorithm to use |
| `--gradient-step GRADIENT_STEP` | Step size for gradient calculation in gradient-based search |
| `--convergence-threshold CONVERGENCE_THRESHOLD` | Convergence threshold for gradient-based search |
| `--n-replicas N_REPLICAS` | Number of replicas for replica exchange |
| `--replica-temperatures REPLICA_TEMPERATURES [REPLICA_TEMPERATURES ...]` | Temperatures for replicas (e.g., 300 400 500 600) |
| `--exchange-steps EXCHANGE_STEPS` | Number of exchange attempts in replica exchange |
| `--surrogate-model {rf,gp,nn}` | Surrogate model type for ML-guided search |
| `--exploitation-factor EXPLOITATION_FACTOR` | Exploitation vs exploration balance (0-1) for ML-guided search |
| `--fragment-min-size FRAGMENT_MIN_SIZE` | Minimum fragment size for fragment-based docking |
| `--growth-steps GROWTH_STEPS` | Number of fragment growth steps |
| `--ga-iterations GA_ITERATIONS` | Genetic algorithm iterations in hybrid search |
| `--lbfgs-iterations LBFGS_ITERATIONS` | L-BFGS iterations in hybrid search |
| `--top-n-for-local TOP_N_FOR_LOCAL` | Top N poses to optimize with L-BFGS in hybrid search |

### Pose Clustering and Analysis
| Argument | Description |
|----------|-------------|
| `--cluster-poses` | Perform clustering of docking poses |
| `--clustering-method {hierarchical,dbscan}` | Method for clustering poses |
| `--rmsd-cutoff RMSD_CUTOFF` | RMSD cutoff for pose clustering |
| `--analyze-interactions` | Generate interaction fingerprints and analysis |
| `--interaction-types {hbond,hydrophobic,ionic,aromatic,halogen}` | Interaction types to include in analysis |
| `--classify-modes` | Classify binding modes of docking poses |
| `--discover-modes` | Automatically discover binding modes from results |
| `--n-modes N_MODES` | Number of binding modes to discover |
| `--energy-decomposition` | Perform energy decomposition analysis |
| `--per-residue-energy` | Calculate per-residue energy contributions |
| `--generate-analysis-report` | Generate comprehensive docking report |
| `--analysis-report-format {html,pdf,txt}` | Format for analysis report |
| `--analysis-report-sections {summary,clusters,interactions,energetics}` | Sections to include in the analysis report |

## Physics-Based Features

PandaDock includes physics-based molecular modeling capabilities that significantly enhance the accuracy of docking results:

- **MMFF94 Force Field Minimization**: Full molecular mechanics energy minimization
- **Enhanced Electrostatics**: Poisson-Boltzmann inspired model with distance-dependent dielectric
- **Implicit Solvation (GB/SA)**: Generalized Born model with surface area-based nonpolar term
- **Monte Carlo Sampling**: Enhanced conformational sampling with Metropolis criterion
- **Physics-Based Scoring**: Complete MM-GBSA inspired scoring function

## Python API Example

```python
from pandadock.protein import Protein
from pandadock.ligand import Ligand
from pandadock.unified_scoring import EnhancedScoringFunction
from pandadock.search import GeneticAlgorithm
from pandadock.utils import save_docking_results

# Load protein and ligand
protein = Protein("protein.pdb")
ligand = Ligand("ligand.sdf")

# Define active site (optional)
protein.define_active_site([10.0, 20.0, 30.0], 12.0)

# Create scoring function
scoring_function = EnhancedScoringFunction()

# Create search algorithm
search_algorithm = GeneticAlgorithm(
    scoring_function, 
    max_iterations=1000,
    population_size=100
)

# Perform docking
results = search_algorithm.search(protein, ligand)

# Save results
save_docking_results(results, "docking_results")
```

## Understanding Results

PandaDock generates several output files in the specified directory:

1. **Docking poses (PDB files)**: Top-scoring ligand conformations
2. **Score plot (PNG)**: Visualization of score distribution
3. **Docking results (TXT)**: Detailed results with scores and statistics
4. **Validation report (TXT)**: RMSD analysis if reference structure provided
5. **Interactive reports (HTML)**: Comprehensive docking analysis reports

## License and Citation

### Open Source License
PandaDock is released under the MIT License.

### Citation
If you use PandaDock in your research, please cite:
```
Pritam Kumar Panda. (2025). PandaDock: Python Molecular Docking. GitHub repository. https://github.com/pritampanda15/PandaDock
```

## Contact and Support

- **Project Website**: [https://github.com/pritampanda15/PandaDock](https://github.com/pritampanda15/PandaDock)
- **Email**: pritam@stanford.edu
- **Issue Tracker**: [GitHub Issues](https://github.com/pritampanda15/PandaDock/issues)
- **Wiki**: [WIKI](https://github.com/pritampanda15/PandaDock/wiki)

---

**Disclaimer**: PandaDock is a research tool. Always validate results and consult domain experts for critical applications.